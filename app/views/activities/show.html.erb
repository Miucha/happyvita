<div class="card-activity-show">

  <div class="mx-1 bg-white mb-2 shadow">
    <div class="card-activity">
      <% if @activity.photo? then %>
        <div class="banner banner_img" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.2)), url('<%= cl_image_path @activity.photo, height: 400, crop: :fit %>')">
      <% else %>
        <div class="banner banner_noimage" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.2)), url('<%= cl_image_path 'smyle', height: 400, crop: :fit %>')">
      <% end %>
        </div>
      <% booking = [] %>
      <% booking = current_user.bookings.select { |booking| booking.activity_id == @activity.id } unless current_user.nil?%>

      <div class="card-activity-infos-show p-2">

        <div class="card-title-and-buttons mr-2">

          <% street = @activity.address.street.nil? ? street = " " : @activity.address.street %>
          <% number = @activity.address.number.nil? ? number = " " : @activity.address.number %>
          <% district = @activity.address.district.nil? ? district = " " : @activity.address.district %>
          <% city = @activity.address.city.nil? ? city = " " : @activity.address.city %>
          <% state = @activity.address.state.nil? ? state = " " : @activity.address.state %>
          <% zipcode = @activity.address.zipcode.nil? ? zipcode = " " : @activity.address.zipcode %>

          <div class="text-left mt-3">
            <h4 class="mt-1 font-weight-bold"><%=@activity.title%></h4>
            <h5 class="mt-1"><%= "#{street} #{number}"%></h5>
            <h5><%= "#{district} #{city} #{state} #{zipcode}"%></h5>

            <%# Share butons by ShareThis.com %>
            <div class="sharethis-inline-share-buttons"></div>

            <div class="d-flex align-items-center mt-2">
<!-- class: "btn btn-warning text-white shadow font-weight-bold mr-2" -->
              <% unless (current_user == nil) || (booking == []) %>
<!--            INCLUIR BOTÃO "ATIVIDADE REALIZADA" abrindo Modal que dê a possibilidade de incluir foto -->
<!-- class: "btn btn-success text-white shadow font-weight-bold" -->
                <% unless booking.first.done %>
                  <%= button_to "EU FIZ", mark_as_done_path(booking.first), method: :patch, class: "btn btn-body-color shadow text-right border border-dark mr-2" %>
                <% end %>
              <% end %>

              <% if (@activity.event == false) && (booking != []) && (booking.first.done == false) %>
                <%= button_to "REAGENDAR", edit_booking_path(booking.first), method: :get, class: "btn btn-body-color shadow text-right border border-dark mr-2" %>
<!--            INCLUIR BOTÃO "CANCELAR PARTICIPAÇÃO" -->
<!-- class: "btn btn-body-color shadow text-right border border-dark mr-2" -->
              <% end %>
            </div>
            <br>
          </div>
        </div>

        <div class="card-event-date text-center mr-2 mt-3">

          <% if current_user == nil || booking == []%>
            <% if @activity.event %>
              <%= button_to "AGENDAR", activity_bookings_path(@activity), method: :post, class: "show-btn-position-img-bottom btn btn-primary shadow text-right font-weight-bold" %>
            <% else %>
              <%= button_to "AGENDAR", new_activity_booking_path(@activity), method: :get, class: "show-btn-position-img-bottom btn btn-primary shadow text-right font-weight-bold" %>
            <% end %>

          <% elsif @activity.event && booking != []%>
              <h5 class="show-btn-position-img-bottom text-center bg-info border border-info rounded p-2 shadow font-weight-bold">AGENDADO</h5>
            <!--   destroy -->

          <% else %>
            <div class="show-btn-position-img-bottom d-flex align-items-center text-center bg-info border border-info rounded p-2 shadow">
              <h5 class="mr-2 font-weight-bold">AGENDADO</h5>
            </div>
          <% end %>

          <% if @activity.event_date %>
            <h1><%= @activity.event_date.strftime("%d")%></h1>
            <h4><%= @activity.event_date.strftime("%b")%></h4>
          <% elsif booking != [] && booking.first.schedule_date %>
            <h1><%= booking.first.schedule_date.strftime("%d")%></h1>
            <h4><%= booking.first.schedule_date.strftime("%b")%></h4>
          <% else %>
            <h1><%= link_to new_activity_booking_path(@activity) do %>
               <i class="far fa-calendar-alt title-link text-decoration-none"></i>
            <% end %></h1>
          <% end %>

        </div>
    </div>
    <div class="p-2 mb-1">
      <% if @activity.event? %>
        <h5>Participantes confirmados: <%= @activity.bookings.count%></h5>
        <h5>Vagas disponíveis: <%= @activity.capacity - @activity.bookings.count%></h5>
      <% else %>
        <h5>Agendaram este desafio: <%= @activity.bookings.count%></h5>
      <% end %>
      <br>
      <h4>Descrição:</h4><br>
      <h5><%= @activity.description.gsub(/\n/, '<br/>').html_safe %></h5>
    </div>
  </div>
</div>

  <% if current_user == @activity.owner%>
    <div class="container bg-white border border-white border-radius shadow activity-admin-card p-2 my-3 text-center">
      <% if @activity.event %>
        <h5>Acesso do administrador do evento publicado:</h5>
        <div class="d-flex mr-2 my-2 justify-content-center">
          <%= button_to "EDITAR", edit_event_path(@activity), method: :get, class: "btn btn-body-color shadow text-right border border-dark mr-2" %>
          <%= button_to "CANCELAR", cancel_activity_path(@activity), method: :patch, data: { confirm: "Quer realmente cancelar este evento?" }, class: "btn btn-body-color shadow text-right border border-dark" %>
        </div>
        <div>
          <h5>Este evento já foi agendado por: </h5>
          <% @activity.bookings.each do |booking| %>
            <p>- <%=booking.user.first_name%> <%=booking.user.last_name%> | E-mail: <b><%=booking.user.email %></b></p>
          <% end %>
        </div>
      <% else %>
        <h5>Acesso do administrador do desafio publicado:</h5>
        <div class="d-flex mr-2 my-2 justify-content-center">
        <%= button_to "EDITAR", edit_challenge_path(@activity), method: :get, class: "btn btn-body-color shadow text-right border border-dark mr-2" %>
        <%= button_to "CANCELAR", cancel_activity_path(@activity), method: :patch, data: { confirm: "Quer realmente cancelar este evento?" }, class: "btn btn-body-color shadow text-right border border-dark" %>
        </div>
        <div>
          <h5>Este desafio já foi agendado por: </h5>
          <% @activity.bookings.each do |booking| %>
            <p>- <%=booking.user.first_name%> <%=booking.user.last_name%> | E-mail: <b><%=booking.user.email %></b></p>
          <% end %>
        </div>
      <% end %>
    </div>
  <% end %>




  <% if @activity.event? %>
    <div
      id="map"
      style="width: 100%;
      height: 400px;"
      data-markers="<%= @markers_activity.to_json %>"
      data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>"
    ></div>
    </div>
  <% end %>




